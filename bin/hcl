#!/usr/bin/env node

var hcl = require('../lib/parser.js');
var compile = require('../lib/compile.js');
var file2js = require('../lib/file2js.js');
var prompt = 'hcl> ';

if (process.argv[2]) {
  file2js(process.argv[2]);
} else {
  // TODO: implement a REPL
  var stdin = process.openStdin();
  process.stdout.write(prompt);
  stdin.on('data', function(text) {
    try {
      var ast = hcl.analyze(hcl.parse(hcl.scan(text.toString())));
      var res = eval('(' + compile(ast[0]).replace(/;$/, '') + ')');
      console.log(res);
    } catch(e) {
      console.log(e);
    }
    process.stdout.write(prompt);
  });
}

